<!-- templates/add_measurement_sheet.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Measurement Sheet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .form-section, .viewer-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
    }
    .table-responsive {
      max-height: 400px;
      overflow-y: auto;
    }
  </style>
</head>
<body class="container-fluid mt-4">

  <h3 class="mb-4">Add Measurement Sheet</h3>

  <div class="row mb-4">
    <!-- Left side: AutoCAD viewer and uploads -->
    <div class="col-md-6 viewer-section">
      <h5>AutoCAD Viewer</h5>
      <div class="mb-3">
        <label>Source Drawing Upload</label>
        <input type="file" class="form-control">
      </div>
      <div class="mb-3">
        <label>Revision Upload</label>
        <input type="file" class="form-control">
      </div>
      <div class="border p-3 mt-3" style="height: 300px;">
        <p>Drawing Preview Area</p>
        <!-- Later weâ€™ll embed viewer -->
      </div>
    </div>

    <!-- Right side: Duct entry form -->
    <div class="col-md-6 form-section">
      <h5>Duct Entry Form</h5>
      <form id="duct-form">
        <div class="row mb-2">
          <div class="col">
            <input type="text" class="form-control" placeholder="Duct No" name="duct_no" required>
          </div>
          <div class="col">
            <input type="text" class="form-control" placeholder="Type" name="type" required>
          </div>
          <div class="col">
            <input type="number" class="form-control" placeholder="W1" name="w1" required>
          </div>
          <div class="col">
            <input type="number" class="form-control" placeholder="H1" name="h1" required>
          </div>
        </div>
        <div class="row mb-2">
          <div class="col">
            <input type="number" class="form-control" placeholder="W2" name="w2">
          </div>
          <div class="col">
            <input type="number" class="form-control" placeholder="H2" name="h2">
          </div>
          <div class="col">
            <input type="text" class="form-control" placeholder="Degree/Offset" name="degree">
          </div>
          <div class="col">
            <input type="number" class="form-control" placeholder="Length/Radius" name="length">
          </div>
        </div>
        <div class="row mb-2">
          <div class="col">
            <input type="number" class="form-control" placeholder="Quantity" name="quantity" required>
          </div>
          <div class="col">
            <input type="number" class="form-control" placeholder="Factor (optional)" name="factor">
          </div>
          <div class="col">
            <button type="submit" class="btn btn-success w-100">Add Entry</button>
          </div>
          <div class="col">
            <button type="reset" class="btn btn-secondary w-100">Cancel</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Live Table -->
  <div class="table-section mt-4">
    <h5>Live Duct Entries</h5>
    <div class="table-responsive">
      <table class="table table-bordered table-sm text-center" id="duct-table">
        <thead class="table-dark">
          <tr>
            <th>Duct No</th>
            <th>Type</th>
            <th>W1</th>
            <th>H1</th>
            <th>W2</th>
            <th>H2</th>
            <th>Degree/Offset</th>
            <th>Length/Radius</th>
            <th>Quantity</th>
            <th>Area</th>
            <th>24g</th>
            <th>22g</th>
            <th>20g</th>
            <th>18g</th>
            <th>Nuts & Bolts</th>
            <th>Cleat</th>
            <th>Gasket</th>
            <th>Corner Pieces</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="live-entries">
          <!-- JS will append entries here -->

          <script>
  const form = document.getElementById("duct-form");
  const tableBody = document.getElementById("live-entries");

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const formData = new FormData(form);
    const entry = {};
    formData.forEach((value, key) => {
      entry[key] = value || '';
    });

    // Placeholder values for later-calculated fields
    entry.area = "";
    entry["24g"] = "";
    entry["22g"] = "";
    entry["20g"] = "";
    entry["18g"] = "";
    entry["nuts"] = "";
    entry["cleat"] = "";
    entry["gasket"] = "";
    entry["corner"] = "";

    const row = document.createElement("tr");
    row.innerHTML = `
      <td contenteditable="true">${entry.duct_no}</td>
      <td contenteditable="true">${entry.type}</td>
      <td contenteditable="true">${entry.w1}</td>
      <td contenteditable="true">${entry.h1}</td>
      <td contenteditable="true">${entry.w2}</td>
      <td contenteditable="true">${entry.h2}</td>
      <td contenteditable="true">${entry.degree}</td>
      <td contenteditable="true">${entry.length}</td>
      <td contenteditable="true">${entry.quantity}</td>
      <td contenteditable="true">${entry.area}</td>
      <td contenteditable="true">${entry["24g"]}</td>
      <td contenteditable="true">${entry["22g"]}</td>
      <td contenteditable="true">${entry["20g"]}</td>
      <td contenteditable="true">${entry["18g"]}</td>
      <td contenteditable="true">${entry.nuts}</td>
      <td contenteditable="true">${entry.cleat}</td>
      <td contenteditable="true">${entry.gasket}</td>
      <td contenteditable="true">${entry.corner}</td>
      <td>
        <button class="btn btn-sm btn-danger btn-delete">Delete</button>
      </td>
    `;

    row.querySelector(".btn-delete").addEventListener("click", function () {
      if (confirm("Are you sure you want to delete this entry?")) {
        row.remove();
      }
    });

    tableBody.appendChild(row);
    form.reset();
  });
          </script>
        </tbody>
      </table>
    </div>

    <!-- Footer buttons -->
    <div class="mt-3 text-end">
      <button class="btn btn-primary">Export</button>
      <button class="btn btn-success">Submit</button>
      <button class="btn btn-outline-dark">Print</button>
    </div>
  </div>

</body>
</html>
