<!-- templates/measurement_sheet.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Measurement Sheet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .left-box {
      border-right: 2px solid #ccc;
      padding-right: 15px;
    }
    .form-section {
      background: #f9f9f9;
      border-radius: 10px;
      padding: 20px;
    }
    .table-section {
      margin-top: 20px;
    }
  </style>
</head>
<body class="container-fluid mt-4">
  <div class="row">
    <!-- Left: AutoCAD + Upload -->
    <div class="col-md-4 left-box">
      <h5>AutoCAD Viewer</h5>
      <div class="mb-3">
        <label class="form-label">Source Drawing Upload</label>
        <input type="file" class="form-control" />
      </div>
      <div class="mb-3">
        <label class="form-label">Revision Upload</label>
        <input type="file" class="form-control" />
      </div>
      <div>
        <label class="form-label">Preview</label>
        <div class="border p-3" style="height: 300px; background: #eee;">[Preview Placeholder]</div>
      </div>
    </div>

    <!-- Right: Form -->
    <div class="col-md-8">
      <div class="form-section">
        <h4 class="mb-3">Duct Entry Form</h4>
        <form id="duct-form">
          <div class="row mb-2">
            <div class="col-md-3"><input type="text" class="form-control" name="duct_no" placeholder="Duct No" required /></div>
            <div class="col-md-3"><input type="text" class="form-control" name="type" placeholder="Type" required /></div>
            <div class="col-md-2"><input type="number" class="form-control" name="w1" placeholder="W1" /></div>
            <div class="col-md-2"><input type="number" class="form-control" name="h1" placeholder="H1" /></div>
            <div class="col-md-2"><input type="number" class="form-control" name="w2" placeholder="W2" /></div>
          </div>
          <div class="row mb-2">
            <div class="col-md-2"><input type="number" class="form-control" name="h2" placeholder="H2" /></div>
            <div class="col-md-2"><input type="text" class="form-control" name="degree" placeholder="Degree/Offset" /></div>
            <div class="col-md-2"><input type="text" class="form-control" name="length" placeholder="Length/Radius" /></div>
            <div class="col-md-2"><input type="number" class="form-control" name="quantity" placeholder="Qty" required /></div>
            <div class="col-md-2"><input type="number" class="form-control" name="factor" placeholder="Factor (optional)" /></div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <button type="submit" class="btn btn-success">Add Entry</button>
              <button type="reset" class="btn btn-secondary">Cancel</button>
            </div>
          </div>
        </form>
      </div>

      <!-- Live Table -->
      <div class="table-section">
        <h5 class="mt-4">Live Duct Entries</h5>
        <table class="table table-bordered table-sm">
          <thead>
            <tr>
              <th>Duct No</th><th>Type</th><th>W1</th><th>H1</th><th>W2</th><th>H2</th>
              <th>Deg/Off</th><th>Len/Radius</th><th>Qty</th><th>Area</th>
              <th>24g</th><th>22g</th><th>20g</th><th>18g</th>
              <th>Nuts</th><th>Cleat</th><th>Gasket</th><th>Corner</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="live-entries"></tbody>
        </table>

        <div class="d-flex gap-2">
          <button class="btn btn-primary">Submit</button>
          <button class="btn btn-info">Export</button>
          <button class="btn btn-dark">Print</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add JS for Entry Handling -->
  <script>
    const form = document.getElementById("duct-form");
    const tableBody = document.getElementById("live-entries");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(form);
      const entry = {};
      formData.forEach((value, key) => {
        entry[key] = value || '';
      });

      entry.area = "";
      entry["24g"] = "";
      entry["22g"] = "";
      entry["20g"] = "";
      entry["18g"] = "";
      entry["nuts"] = "";
      entry["cleat"] = "";
      entry["gasket"] = "";
      entry["corner"] = "";

      const row = document.createElement("tr");
      row.innerHTML = `
        <td contenteditable="true">${entry.duct_no}</td>
        <td contenteditable="true">${entry.type}</td>
        <td contenteditable="true">${entry.w1}</td>
        <td contenteditable="true">${entry.h1}</td>
        <td contenteditable="true">${entry.w2}</td>
        <td contenteditable="true">${entry.h2}</td>
        <td contenteditable="true">${entry.degree}</td>
        <td contenteditable="true">${entry.length}</td>
        <td contenteditable="true">${entry.quantity}</td>
        <td contenteditable="true">${entry.area}</td>
        <td contenteditable="true">${entry["24g"]}</td>
        <td contenteditable="true">${entry["22g"]}</td>
        <td contenteditable="true">${entry["20g"]}</td>
        <td contenteditable="true">${entry["18g"]}</td>
        <td contenteditable="true">${entry.nuts}</td>
        <td contenteditable="true">${entry.cleat}</td>
        <td contenteditable="true">${entry.gasket}</td>
        <td contenteditable="true">${entry.corner}</td>
        <td><button class="btn btn-sm btn-danger btn-delete">Delete</button></td>
      `;

      row.querySelector(".btn-delete").addEventListener("click", function () {
        if (confirm("Are you sure you want to delete this entry?")) {
          row.remove();
        }
      });

      tableBody.appendChild(row);
      form.reset();
    });
  </script>
</body>
</html>
